<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>An√°lisis Num√©rico</title>

<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

<style>
*{box-sizing:border-box;font-family:"Segoe UI",Arial,sans-serif;}
body{margin:0;background:#eef1f5}

.submenu{
    max-height:0;
    overflow:hidden;
    opacity:0;
    margin-left:10px;
    transition:max-height 0.4s ease, opacity 0.3s ease;
}
.submenu.active{
    max-height:500px; /* suficiente espacio */
    opacity:1;
}
.sub-btn{
    width:100%;
    padding:10px;
    margin-bottom:5px;
    background:#1e5aa8;
    color:white;
    border:none;
    border-radius:6px;
    cursor:pointer;
    text-align:left;
    font-size:14px;
}
.sub-btn:hover{
    background:#2d74d6;
}

/* HEADER */
header{background:linear-gradient(90deg,#002855,#004e92);color:white;padding:20px}
header h1{margin:0;font-size:28px}
header p{margin:5px 0 0;opacity:.9}

/* LAYOUT */
.app{display:flex;height:calc(100vh - 80px)}

/* SIDEBAR */
.sidebar{width:250px;background:#0b2545;color:white;padding:20px}
.sidebar h2{font-size:18px;margin-bottom:15px;border-bottom:1px solid rgba(255,255,255,.2)}
.menu-btn{width:100%;padding:12px;margin-bottom:10px;background:#133c73;color:white;border:none;border-radius:6px;cursor:pointer;text-align:left}
.menu-btn:hover{background:#1e5aa8}

/* CONTENT */
.content{flex:1;padding:30px;overflow:auto}
.card{background:white;border-radius:10px;padding:25px;box-shadow:0 10px 25px rgba(0,0,0,.1)}
.card h2{color:#002855;margin-top:0}

/* INPUTS */
.inputs{display:grid;grid-template-columns:repeat(4,1fr);gap:15px}
.inputs input{padding:10px;border-radius:6px;border:1px solid #ccc}

button.calc{margin-top:10px;padding:12px 18px;background:#004e92;color:white;border:none;border-radius:6px;cursor:pointer}
button.calc:hover{background:#0066c2}

#plotBiseccion,#plotFalsa{margin-top:25px}

/* SECCIONES */
.section{display:none}
.section.active{display:block}

/* TECLADO */
.keyboard{
    margin-top:15px;
    display:grid;
    grid-template-columns:repeat(6,1fr);
    gap:8px;
}
.keyboard button{
    padding:10px;
    border:none;
    border-radius:6px;
    background:#e1e5ea;
    cursor:pointer;
    font-weight:600;
}
.keyboard button:hover{background:#cdd5df}

/*stilo tablas*/
table{
    width:100%;
    border-collapse:collapse;
    margin-top:20px;
    font-size:14px;
}
th,td{
    border:1px solid #ccc;
    padding:6px;
    text-align:center;
}
th{
    background:#004e92;
    color:white;
}
tbody tr:nth-child(even){
    background:#f2f2f2;
}
</style>
</head>

<body>

<header>
    <h1>An√°lisis Num√©rico</h1>
    <p>El TI REX</p>
</header>

<div class="app">
<aside class="sidebar">
    <h2>Temario</h2>

    <button class="menu-btn" onclick="mostrar('inicio')">üè† Inicio</button>

    <!-- UNIDAD 1 (SIN SUBMEN√ö) -->
    <button class="menu-btn" onclick="mostrar('unidad1')">
        üìò Unidad 1 ‚Äì Fundamentos
    </button>

    <!-- UNIDAD 2 (CON SUBMEN√ö) -->
    <button class="menu-btn" onclick="toggleSubmenu('u2')">
        üìó Unidad 2 ‚Äì M√©todos Cerrados y Abiertos
    </button>

    <div id="u2" class="submenu">
        <button class="sub-btn" onclick="mostrar('biseccion')">Bisecci√≥n</button>
        <button class="sub-btn" onclick="mostrar('falsa')">Falsa Posici√≥n</button>
        <button class="sub-btn" onhaclick="mostrar('newton')">Newton-Raphson</button>
        <button class="sub-btn" onclick="mostrar('secante')">Secante</button>
        <button class="sub-btn" onclick="mostrar('puntoFijo')">Punto Fijo</button>
    </div>

    <!-- UNIDADES RESTANTES -->
    <button class="menu-btn" onclick="mostrar('unidad3')">üìô Unidad 3</button>
    <button class="menu-btn" onclick="mostrar('unidad4')">üìï Unidad 4</button>
    <button class="menu-btn" onclick="mostrar('unidad5')">üìí Unidad 5</button>
    <button class="menu-btn" onclick="mostrar('unidad6')">üìì Unidad 6</button>
    <button class="menu-btn" onclick="mostrar('unidad7')">üìî Unidad 7</button>

</aside>

<main class="content">

<div id="inicio" class="section active">
<div class="card">

<h2>Bienvenido</h2>

<div style="margin-top:10px; padding:20px; background:#f4f7fb; border-left:6px solid #004e92; border-radius:8px;">

<h3 style="margin-top:0; color:#002855;">
Proyecto Acad√©mico ‚Äì An√°lisis Num√©rico
</h3>

<p style="line-height:1.6; font-size:15px;">
Esta plataforma fue desarrollada por <b>Carlos Roberto Ake Chan</b> 
como proyecto para la materia de <b>An√°lisis Num√©rico</b>.
</p>

<p style="line-height:1.6; font-size:15px;">
El objetivo principal de esta p√°gina es facilitar el c√°lculo de 
m√©todos num√©ricos como:
</p>

<ul style="line-height:1.6; font-size:15px;">
<li>M√©todo de Bisecci√≥n</li>
<li>M√©todo de Falsa Posici√≥n</li>
<li>M√©todo de Newton-Raphson</li>
<li>M√©todo de la Secante</li>
<li>M√©todo de Punto Fijo</li>
</ul>

<p style="line-height:1.6; font-size:15px;">
La plataforma permite realizar c√°lculos de manera <b>m√°s r√°pida, visual e interactiva</b>,
mostrando tablas detalladas de iteraciones, errores porcentuales y representaciones gr√°ficas din√°micas.
</p>

<p style="line-height:1.6; font-size:15px;">
Este sistema fue dise√±ado con el prop√≥sito de reforzar el aprendizaje,
optimizar el tiempo de resoluci√≥n y brindar una mejor comprensi√≥n visual
del comportamiento matem√°tico de cada m√©todo.
</p>

<p style="line-height:1.6; font-size:15px; margin-top:15px;">
A continuaci√≥n se presenta un <b>video introductorio</b> sobre el tema,
el cual explica los fundamentos del an√°lisis num√©rico y la importancia
de los m√©todos implementados en esta plataforma.
</p>

</div>

<div style="margin-top:25px;">
   <iframe 
    width="100%" 
    height="450"
    style="border-radius:12px; box-shadow:0 10px 25px rgba(0,0,0,.2);"
    src="https://www.youtube-nocookie.com/embed/ujNG6Ns2rlw?rel=0"
    frameborder="0"
    allowfullscreen>
</iframe>
</div>

</div>
</div>

<!-- UNIDAD 1 -->
<div id="unidad1" class="section">
<div class="card">

<h2>üìò Unidad 1 ‚Äì Fundamentos del An√°lisis Num√©rico</h2>

<hr style="margin:20px 0">

<h3>1.1 ¬øQu√© es el An√°lisis Num√©rico?</h3>

<div style="display:flex;gap:20px;align-items:center;flex-wrap:wrap;">
    <div style="flex:1;min-width:250px;">
        <p>
        El an√°lisis num√©rico es la rama de las matem√°ticas que estudia 
        los m√©todos para obtener soluciones aproximadas a problemas 
        matem√°ticos mediante algoritmos computacionales.
        </p>

        <p>
        Se utiliza cuando una soluci√≥n exacta es dif√≠cil o imposible 
        de obtener de forma anal√≠tica.
        </p>
    </div>

    <div style="flex:1;min-width:250px;">
        <img src="https://upload.wikimedia.org/wikipedia/commons/3/3a/NewtonIteration_Ani.gif"
             style="width:100%;border-radius:10px;box-shadow:0 10px 20px rgba(0,0,0,.2);">
    </div>
</div>

<hr style="margin:30px 0">

<h3>1.2 Importancia en la Ingenier√≠a</h3>

<div style="background:#f4f7fb;padding:15px;border-left:6px solid #004e92;border-radius:8px;">
El an√°lisis num√©rico es esencial en:
<ul>
<li>‚ö° Ingenier√≠a el√©ctrica</li>
<li>üèó Ingenier√≠a civil</li>
<li>üöó Ingenier√≠a mec√°nica</li>
<li>üíª Simulaci√≥n computacional</li>
<li>üìä Modelado matem√°tico</li>
</ul>
</div>

<hr style="margin:30px 0">

<h3>1.3 Tipos de Error</h3>

<div style="display:flex;gap:20px;flex-wrap:wrap;">

<div style="flex:1;min-width:220px;background:#ffffff;padding:15px;border-radius:10px;box-shadow:0 5px 15px rgba(0,0,0,.1);">
<b>Error Absoluto</b>
<p>E‚Çê = | Valor real ‚àí Valor aproximado |</p>
</div>

<div style="flex:1;min-width:220px;background:#ffffff;padding:15px;border-radius:10px;box-shadow:0 5px 15px rgba(0,0,0,.1);">
<b>Error Relativo</b>
<p>E·µ£ = E‚Çê / |Valor real|</p>
</div>

<div style="flex:1;min-width:220px;background:#ffffff;padding:15px;border-radius:10px;box-shadow:0 5px 15px rgba(0,0,0,.1);">
<b>Error Porcentual</b>
<p>E‚Çö = E·µ£ √ó 100%</p>
</div>

</div>

<hr style="margin:30px 0">

<h3>1.4 Errores Computacionales</h3>

<div style="display:flex;gap:20px;align-items:center;flex-wrap:wrap;">
    <div style="flex:1;min-width:250px;">
        <p>
        En los c√°lculos num√©ricos pueden aparecer errores debido a:
        </p>
        <ul>
            <li>Error de redondeo</li>
            <li>Error de truncamiento</li>
            <li>Limitaciones del hardware</li>
        </ul>
    </div>

    <div style="flex:1;min-width:250px;">
        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/7/7e/Floating_point_number_representation.svg/640px-Floating_point_number_representation.svg.png"
             style="width:100%;border-radius:10px;box-shadow:0 10px 20px rgba(0,0,0,.2);">
    </div>
</div>

<hr style="margin:30px 0">

<h3>1.5 Ejemplo Ilustrativo</h3>

<div style="background:#fff3cd;padding:15px;border-radius:8px;border-left:6px solid #ffc107;">
Supongamos que el valor real es 3.1416 y el valor aproximado es 3.14.
<br><br>
Error absoluto = 0.0016  
<br>
Error relativo ‚âà 0.000509  
<br>
Error porcentual ‚âà 0.0509%
</div>

<hr style="margin:30px 0">

<div style="text-align:center;margin-top:20px;">
<b>üìå Conclusi√≥n:</b>
<p>
El an√°lisis num√©rico permite obtener soluciones confiables 
mediante m√©todos iterativos, siendo fundamental en la ingenier√≠a moderna.
</p>
</div>

</div>
</div>
    
<!-- BISECCI√ìN -->
<div id="biseccion" class="section">
<div class="card">
<h2>M√©todo de Bisecci√≥n</h2>

<div class="inputs">
<input class="func" id="funcB" placeholder="f(x)">
<input id="aB" placeholder="a">
<input id="bB" placeholder="b">
<input id="tolB" placeholder="Tolerancia">
</div>

<div class="keyboard"></div>

<button class="calc" onclick="biseccion()">Calcular</button>
<input type="range" id="sliderB" min="0" value="0" oninput="grafBiseccion()">
<div id="plotBiseccion"></div>
<div id="tablaB"></div>
</div>
</div>

<!-- FALSA -->
<div id="falsa" class="section">
<div class="card">
<h2>M√©todo de Falsa Posici√≥n</h2>

<div class="inputs">
<input class="func" id="funcF" placeholder="f(x)">
<input id="aF" placeholder="a">
<input id="bF" placeholder="b">
<input id="tolF" placeholder="Tolerancia">
</div>

<div class="keyboard"></div>

<button class="calc" onclick="falsaPosicion()">Calcular</button>
<input type="range" id="sliderF" min="0" value="0" oninput="grafFalsa()">
<div id="plotFalsa"></div>
<div id="tablaF"></div>
</div>
</div>

<!-- NEWTON RAPHSON -->
<div id="newton" class="section">
<div class="card">
<h2>M√©todo de Newton-Raphson</h2>

<div class="inputs">
<input class="func" id="funcN" placeholder="f(x)">
<input id="x0N" placeholder="Valor inicial x0">
<input id="tolN" placeholder="Tolerancia">
<input id="maxN" placeholder="Max Iter (opcional)">
</div>

<div class="keyboard"></div>

<button class="calc" onclick="newton()">Calcular</button>
<input type="range" id="sliderN" min="0" value="0" oninput="grafNewton()">
<div id="plotNewton"></div>
<div id="tablaN"></div>
</div>
</div>

<!-- SECANTE -->
<div id="secante" class="section">
<div class="card">
<h2>M√©todo de la Secante</h2>

<div class="inputs">
<input class="func" id="funcS" placeholder="f(x)">
<input id="x0S" placeholder="x0">
<input id="x1S" placeholder="x1">
<input id="tolS" placeholder="Tolerancia (%)">
</div>

<div class="keyboard"></div>

<button class="calc" onclick="secante()">Calcular</button>
<input type="range" id="sliderS" min="0" value="0" oninput="grafSecante()">
<div id="plotSecante"></div>
<div id="tablaS"></div>
</div>
</div>

<!-- PUNTO FIJO -->
<div id="puntoFijo" class="section">
<div class="card">
<h2>M√©todo de Punto Fijo</h2>

<div class="inputs">
<input class="func" id="funcG" placeholder="g(x)">
<input id="x0G" placeholder="Valor inicial x0">
<input id="tolG" placeholder="Tolerancia (%)">
<input id="maxG" placeholder="Max Iter (opcional)">
</div>

<div class="keyboard"></div>

<button class="calc" onclick="puntoFijo()">Calcular</button>
<input type="range" id="sliderG" min="0" value="0" oninput="grafPuntoFijo()">
<div id="plotPuntoFijo"></div>
<div id="tablaG"></div>
</div>
</div>

</main>
</div>

<script>
/* ================= PARSER ================= */
function parseFuncion(expr){
    return expr
        .replace(/\s+/g,"")

        /* multiplicaci√≥n impl√≠cita */
        .replace(/(\d)(x)/g,"$1*$2")
        .replace(/(\d)(\()/g,"$1*(")
        .replace(/(x)(\d)/g,"$1*$2")
        .replace(/(\))(x)/g,")*x")
        .replace(/(\))(\()/g,")*(")
        .replace(/(pi)(\()/gi,"pi*(")

        /* constantes */
        .replace(/pi/gi,"Math.PI")
        .replace(/\be\b/g,"Math.E")

        /* funciones */
        .replace(/\^/g,"**")
        .replace(/exp\(/gi,"Math.exp(")
        .replace(/sin\(/gi,"Math.sin(")
        .replace(/cos\(/gi,"Math.cos(")
        .replace(/tan\(/gi,"Math.tan(")
        .replace(/log\(/gi,"Math.log10(")
        .replace(/ln\(/gi,"Math.log(")
        .replace(/sqrt\(/gi,"Math.sqrt(")
        .replace(/abs\(/gi,"Math.abs(");
}


/* ================= TECLADO ================= */
let activeInput=null;
document.addEventListener("focusin",e=>{
    if(e.target.classList.contains("func")) activeInput=e.target;
});

const keys=["7","8","9","+","-","*",
            "4","5","6","/","^","(",
            "1","2","3",")","x",".",
            "0","sin(","cos(","tan(","ln(","exp(",
            "sqrt(","abs(","log(","pi","e","‚å´"];

document.querySelectorAll(".keyboard").forEach(kb=>{
    keys.forEach(k=>{
        let b=document.createElement("button");
        b.textContent=k;
        b.onclick=()=>insertKey(k);
        kb.appendChild(b);
    });
});

function insertKey(k){
    if(!activeInput) return;
    if(k==="‚å´") activeInput.value=activeInput.value.slice(0,-1);
    else if(k==="pi") activeInput.value+="pi";
    else if(k==="e") activeInput.value+="e";
    else activeInput.value+=k;
}

/* ================= NAVEGACI√ìN ================= */
function mostrar(id){
    document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
    document.getElementById(id).classList.add("active");
}

/* ================= menusub ================= */
function toggleSubmenu(id){

    let menu = document.getElementById(id);

    document.querySelectorAll(".submenu").forEach(s=>{
        if(s.id !== id){
            s.classList.remove("active");
        }
    });

    menu.classList.toggle("active");
}

/* ================= BISECCI√ìN ================= */
let itB=[],fB;
function biseccion(){
    itB=[];
    fB=new Function("x","return "+parseFuncion(funcB.value));
    let a=+aB.value,b=+bB.value,t=+tolB.value,c;
    if(fB(a)*fB(b)>0){
        alert("El intervalo no cumple f(a)*f(b)<0");
        return;
    }
    let iter=0,maxIter=100;
    while(iter<maxIter){
        c=(a+b)/2;

        let error = 0;
if(itB.length > 0){
    let cPrev = itB[itB.length-1].c;
   error = Math.abs(c - cPrev);
}
itB.push({a,b,c,error});

        if(!isFinite(fB(c))){
            alert("La funci√≥n genera infinito o NaN");
            return;
        }
        if(error < t && iter > 0) break;
        fB(a)*fB(c)<0?b=c:a=c;
        iter++;
    }
    sliderB.max=itB.length-1;
    grafBiseccion();
    generarTablaB();

}

function grafBiseccion(){
    let i=sliderB.value,{a,b,c}=itB[i];
    let xs=[],ys=[];
    for(let x=a-2;x<=b+2;x+=0.05){
        xs.push(x);
        ys.push(fB(x));
    }
    Plotly.newPlot("plotBiseccion",[
        {x:xs,y:ys,mode:"lines",name:"f(x)"},
        {x:[a],y:[fB(a)],mode:"markers",marker:{color:"red",size:10},name:"a"},
        {x:[b],y:[fB(b)],mode:"markers",marker:{color:"green",size:10},name:"b"},
        {x:[c],y:[fB(c)],mode:"markers",marker:{color:"orange",size:12},name:"ra√≠z"}
    ],{title:`Iteraci√≥n ${+i+1}`});
}

/* ================= FALSA POSICI√ìN ================= */
let itF=[],fF;
function falsaPosicion(){
    itF=[];
    fF=new Function("x","return "+parseFuncion(funcF.value));
    let a=+aF.value,b=+bF.value,t=+tolF.value,c;

    if(fF(a)*fF(b)>0){
        alert("El intervalo no cumple f(a)*f(b)<0");
        return;
    }
    let iter=0,maxIter=100;
    while(iter<maxIter){
        c=(a*fF(b)-b*fF(a))/(fF(b)-fF(a));
        let error = 0;
        if(itF.length > 0){
            let cPrev = itF[itF.length-1].c;
            error = Math.abs(c - cPrev);
        }
        itF.push({a,b,c,error});
        if(!isFinite(fF(c))){
            alert("La funci√≥n genera infinito o NaN");
            return;
        }
        if(error < t && iter>0) break;
        fF(a)*fF(c)<0?b=c:a=c;
        iter++;
    }
    sliderF.max=itF.length-1;
    grafFalsa();
    generarTablaF();
}

function grafFalsa(){
    let i=sliderF.value,{a,b,c}=itF[i];
    let xs=[],ys=[];
    for(let x=a-2;x<=b+2;x+=0.05){
        xs.push(x);
        ys.push(fF(x));
    }
    Plotly.newPlot("plotFalsa",[
        {x:xs,y:ys,mode:"lines",name:"f(x)"},
        {x:[a],y:[fF(a)],mode:"markers",marker:{color:"red",size:10},name:"a"},
        {x:[b],y:[fF(b)],mode:"markers",marker:{color:"green",size:10},name:"b"},
        {x:[c],y:[fF(c)],mode:"markers",marker:{color:"orange",size:12},name:"ra√≠z"}
    ],{title:`Iteraci√≥n ${+i+1}`});
}

/*generar tabla biseccion*/
function generarTablaB(){
    let html=`<table>
    <thead>
        <tr>
            <th>Iter</th>
            <th>a</th>
            <th>b</th>
            <th>c</th>
            <th>f(c)</th>
            <th>Error</th>
        </tr>
    </thead>
    <tbody>`;

    itB.forEach((it,i)=>{
        html+=`
        <tr>
            <td>${i+1}</td>
            <td>${it.a.toFixed(6)}</td>
            <td>${it.b.toFixed(6)}</td>
            <td>${it.c.toFixed(6)}</td>
            <td>${fB(it.c).toExponential(3)}</td>
            <td>${it.error.toFixed(6)}</td>
        </tr>`;
    });

    html+=`</tbody></table>`;
    document.getElementById("tablaB").innerHTML=html;
}

/*generar tabla poison*/
function generarTablaF(){
    let html=`<table>
    <thead>
        <tr>
            <th>Iter</th>
            <th>a</th>
            <th>b</th>
            <th>c</th>
            <th>f(c)</th>
<th>Error %</th>
        </tr>
    </thead>
    <tbody>`;
    itF.forEach((it,i)=>{
        html+=`
        <tr>
    <td>${i+1}</td>
    <td>${it.a.toFixed(6)}</td>
    <td>${it.b.toFixed(6)}</td>
    <td>${it.c.toFixed(6)}</td>
    <td>${fF(it.c).toExponential(3)}</td>
    <td>${it.error.toFixed(4)}%</td>
</tr>`;
    });
    html+=`</tbody></table>`;
    document.getElementById("tablaF").innerHTML=html;
}

/* ================= NEWTON RAPHSON ================= */
let itN=[], fN;

function derivadaNumerica(f,x){
    let h = 1e-6;
    return (f(x+h) - f(x-h)) / (2*h);
}
function newton(){
    itN=[];
    fN = new Function("x","return "+parseFuncion(funcN.value));

    let x = +x0N.value;
    let tol = +tolN.value;
    let maxIter = maxN.value ? +maxN.value : 100;

    let iter = 0;

    while(iter < maxIter){
        let fx = fN(x);
        let dfx = derivadaNumerica(fN,x);

        if(!isFinite(fx) || !isFinite(dfx)){
            alert("La funci√≥n genera infinito o NaN");
            return;
        }

        if(Math.abs(dfx) < 1e-12){
            alert("Derivada cercana a cero. M√©todo falla.");
            return;
        }
        let x1 = x - fx/dfx;
        let error = 0;
if(iter > 0){
    error = Math.abs((x1 - x) / x1) * 100;
}
        itN.push({x, fx, dfx, x1, error});

        if(error < tol && iter > 0) break;

        x = x1;
        iter++;
    }
    sliderN.max = itN.length - 1;
    grafNewton();
    generarTablaN();
}

function grafNewton(){
    let i = sliderN.value;
    let {x,x1} = itN[i];

    let xs=[], ys=[];
    for(let k=x-5; k<=x+5; k+=0.05){
        xs.push(k);
        ys.push(fN(k));
    }
    Plotly.newPlot("plotNewton",[
        {x:xs,y:ys,mode:"lines",name:"f(x)"},
        {x:[x],y:[fN(x)],mode:"markers",marker:{color:"red",size:10},name:"x_n"},
        {x:[x1],y:[0],mode:"markers",marker:{color:"orange",size:12},name:"x_{n+1}"}
    ],{title:`Iteraci√≥n ${+i+1}`});
}

function generarTablaN(){
    let html=`<table>
    <thead>
        <tr>
            <th>Iter</th>
            <th>x_n</th>
            <th>f(x_n)</th>
            <th>f'(x_n)</th>
            <th>x_{n+1}</th>
            <th>Error</th>
        </tr>
    </thead>
    <tbody>`;

    itN.forEach((it,i)=>{
        html+=`
        <tr>
            <td>${i+1}</td>
            <td>${it.x.toFixed(6)}</td>
            <td>${it.fx.toExponential(3)}</td>
            <td>${it.dfx.toExponential(3)}</td>
            <td>${it.x1.toFixed(6)}</td>
            <td>${it.error.toFixed(6)}%</td>
        </tr>`;
    });

    html+=`</tbody></table>`;
    document.getElementById("tablaN").innerHTML=html;
}

/* ================= SECANTE ================= */
let itS=[], fS;

function secante(){
    itS=[];
    fS = new Function("x","return "+parseFuncion(funcS.value));

    let x0 = +x0S.value;
    let x1 = +x1S.value;
    let tol = +tolS.value;

    let iter = 0;
    let maxIter = 100;

    while(iter < maxIter){

        let fx0 = fS(x0);
        let fx1 = fS(x1);

        if(!isFinite(fx0) || !isFinite(fx1)){
            alert("La funci√≥n genera infinito o NaN");
            return;
        }

        let denom = fx1 - fx0;

        if(Math.abs(denom) < 1e-12){
            alert("Divisi√≥n entre cero en la f√≥rmula de secante");
            return;
        }

        let x2 = x1 - fx1*(x1 - x0)/denom;

        let error = 0;
        if(iter > 0){
            if(Math.abs(x2) > 1e-12){
                error = Math.abs((x2 - x1)/x2) * 100;
            } else {
                error = Math.abs(x2 - x1) * 100;
            }
        }

        itS.push({x0,x1,x2,error});

        if(error < tol && iter > 0) break;

        x0 = x1;
        x1 = x2;

        iter++;
    }

    sliderS.max = itS.length - 1;
    grafSecante();
    generarTablaS();
}

function grafSecante(){
    let i = sliderS.value;
    let {x0,x1,x2} = itS[i];

    let xs=[], ys=[];
    for(let k=x0-5; k<=x1+5; k+=0.05){
        xs.push(k);
        ys.push(fS(k));
    }

    Plotly.newPlot("plotSecante",[
        {x:xs,y:ys,mode:"lines",name:"f(x)"},
        {x:[x0],y:[fS(x0)],mode:"markers",marker:{color:"red",size:10},name:"x0"},
        {x:[x1],y:[fS(x1)],mode:"markers",marker:{color:"green",size:10},name:"x1"},
        {x:[x2],y:[0],mode:"markers",marker:{color:"orange",size:12},name:"x2"}
    ],{title:`Iteraci√≥n ${+i+1}`});
}

function generarTablaS(){
    let html=`<table>
    <thead>
        <tr>
            <th>Iter</th>
            <th>x‚ÇÄ</th>
            <th>x‚ÇÅ</th>
            <th>x‚ÇÇ</th>
            <th>Error %</th>
        </tr>
    </thead>
    <tbody>`;

    itS.forEach((it,i)=>{
        html+=`
        <tr>
            <td>${i+1}</td>
            <td>${it.x0.toFixed(6)}</td>
            <td>${it.x1.toFixed(6)}</td>
            <td>${it.x2.toFixed(6)}</td>
            <td>${it.error.toFixed(6)}%</td>
        </tr>`;
    });

    html+=`</tbody></table>`;
    document.getElementById("tablaS").innerHTML=html;
}

/* ================= PUNTO FIJO ================= */
let itG=[], gFunc;

function puntoFijo(){
    itG=[];
    gFunc = new Function("x","return "+parseFuncion(funcG.value));

    let x = +x0G.value;
    let tol = +tolG.value;
    let maxIter = maxG.value ? +maxG.value : 100;

    // üîé VALIDACI√ìN DE CONVERGENCIA
    let dg = derivadaNumerica(gFunc,x);

    if(!isFinite(dg)){
        alert("No se pudo evaluar la derivada en el punto inicial.");
        return;
    }

    if(Math.abs(dg) >= 1){
        alert("‚ö† Advertencia: |g'(x0)| ‚â• 1. El m√©todo puede divergir.");
        // NO detenemos el m√©todo, solo advertimos
    }

    let iter = 0;

    while(iter < maxIter){

        let x1 = gFunc(x);

        if(!isFinite(x1)){
            alert("La funci√≥n genera infinito o NaN");
            return;
        }

        let error = 0;

        if(iter > 0){
            if(Math.abs(x1) > 1e-12){
                error = Math.abs((x1 - x)/x1) * 100;
            } else {
                error = Math.abs(x1 - x) * 100;
            }
        }

        itG.push({x,x1,error});

        if(error < tol && iter > 0) break;

        x = x1;
        iter++;
    }

    sliderG.max = itG.length - 1;
    grafPuntoFijo();
    generarTablaG();
}

function grafPuntoFijo(){
    let i = sliderG.value;
    let {x,x1} = itG[i];

    let min = Math.min(x,x1);
    let max = Math.max(x,x1);

    let margen = Math.abs(max - min) * 2;
    if(margen < 0.5) margen = 0.5;

    let xs=[], ysG=[], ysX=[];

    let paso = (max-min+margen*2)/200;

    for(let k=min-margen; k<=max+margen; k+=paso){
        xs.push(k);
        ysG.push(gFunc(k));   // g(x)
        ysX.push(k);          // y = x
    }

    Plotly.newPlot("plotPuntoFijo",[
        {x:xs,y:ysG,mode:"lines",name:"g(x)"},
        {x:xs,y:ysX,mode:"lines",name:"y = x"},
        {x:[x],y:[gFunc(x)],mode:"markers",
            marker:{color:"red",size:10},
            name:"x_n"},
        {x:[x1],y:[x1],mode:"markers",
            marker:{color:"orange",size:12},
            name:"x_{n+1}"}
    ],{
        title:`Iteraci√≥n ${+i+1}`,
        xaxis:{range:[min-margen,max+margen]}
    });
}

function generarTablaG(){
    let html=`<table>
    <thead>
        <tr>
            <th>Iter</th>
            <th>x_n</th>
            <th>x_{n+1}</th>
            <th>Error %</th>
        </tr>
    </thead>
    <tbody>`;

    itG.forEach((it,i)=>{
        html+=`
        <tr>
            <td>${i+1}</td>
            <td>${it.x.toFixed(6)}</td>
            <td>${it.x1.toFixed(6)}</td>
            <td>${it.error.toFixed(6)}%</td>
        </tr>`;
    });

    html+=`</tbody></table>`;
    document.getElementById("tablaG").innerHTML=html;
}

</script>

</body>
</html>
